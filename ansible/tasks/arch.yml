---
- name: Install base and essentials
  pacman:
    name: [
      base-devel,
      git,
      git-delta,
      zsh,
      curl,
      wget,
      unzip,
      ca-certificates,
      gnupg,
      htop,
      tree,
      jq,
      ripgrep,
      glow,
      fd,
      bat,
      fzf,
      stow,
      go,
      gnome-keyring
    ]
    state: present
  tags: [system, update, essentials]

- name: Install terminal emulators
  pacman:
    name: [ alacritty, kitty, ghostty ]
    state: present
  tags: [terminal]

- name: Install shell, prompt, and multiplexer tools
  pacman:
    name: [ starship, atuin, zellij, tmux ]
    state: present
  tags: [shell, terminal, productivity]

- name: Install CLI productivity and developer tools
  pacman:
    name: [
      eza,
      tealdeer,
      yq,
      httpie,
      github-cli,
      lazygit,
      lazydocker,
      direnv,
      sops,
      age,
      btop,
      just
    ]
    state: present
  tags: [productivity, devtools]

- name: Install desktop and window manager packages
  pacman:
    name: [
      dunst,
      feh,
      pavucontrol,
      flameshot,
      arandr,
      brightnessctl,
      wireplumber,
      waybar,
      hyprland,
      hyprpaper,
      greetd,
      i3blocks,
      i3-wm,
      i3status,
      wofi,
      rofi,
      lynx,
      swww
    ]
    state: present
  tags: [desktop, wm]

- name: Install Docker packages
  pacman:
    name: [ docker, docker-compose ]
    state: present
  tags: [docker]

- name: Clone yay from AUR
  git:
    repo: "https://aur.archlinux.org/yay.git"
    dest: "/tmp/yay"
    update: yes
  tags: [yay]
  ignore_errors: yes

- name: Build and install yay
  shell: |
    cd /tmp/yay
    makepkg -si --noconfirm
  args:
    chdir: "/tmp/yay"
    creates: /usr/bin/yay
  tags: [yay]

- name: Install Rust development tools
  pacman:
    name: [ rustup ]
    state: present
  tags: [rust]

- name: Install Python development tools
  pacman:
    name: [ python-pip, python-virtualenv, python-poetry ]
    state: present
  tags: [python]

- name: Install Node.js development tools
  pacman:
    name: [ nodejs, npm, yarn ]
    state: present
  tags: [nodejs]

- name: Install cpp development tools
  pacman:
    name: [ cppcheck, lcov, gcovr, radare2, clang, clang-tools-extra, lldb, lld, cmake, ninja, meson, gdb, valgrind, ccache, pkgconf, bear ]
    state: present
  tags: [cpp]

- name: Install file managers
  pacman:
    name: [ ranger, dolphin, yazi ]
    state: present
  tags: [filemanager]

- name: Install PDF utilities
  pacman:
    name: [ evince ]
    state: present
  tags: [pdf]

- name: Add current user to docker group
  user:
    name: "{{ ansible_user_id }}"
    groups: docker
    append: yes
  tags: [docker]
