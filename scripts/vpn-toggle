#!/usr/bin/env bash
set -euo pipefail

if ! command -v nmcli >/dev/null 2>&1; then
  echo "nmcli not found" >&2
  exit 1
fi

VPN_NAME="${1:-${VPN_NAME:-}}"
if [[ -z "${VPN_NAME}" ]]; then
  echo "Usage: vpn-toggle <connection-name>  # or set VPN_NAME env" >&2
  nmcli -t -f NAME,TYPE connection show | awk -F: '$2=="vpn"{print $1}'
  exit 2
fi

if nmcli -t -f NAME,TYPE,DEVICE connection show --active | grep -q "^${VPN_NAME}:vpn:"; then
  nmcli connection down "${VPN_NAME}"
  echo "VPN '${VPN_NAME}': disconnected"
else
  nmcli connection up "${VPN_NAME}"
  echo "VPN '${VPN_NAME}': connected"
fi


